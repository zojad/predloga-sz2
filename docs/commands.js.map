{"version":3,"file":"commands.js","mappings":"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","sources":["webpack://office-addin-taskpane-js/./src/commands/commands.js"],"sourcesContent":["/* global Office, Word */\n\n// Helper wrappers for NotificationMessages (guard against undefined)\nfunction clearNotification(id) {\n  if (\n    Office.NotificationMessages &&\n    typeof Office.NotificationMessages.deleteAsync === \"function\"\n  ) {\n    Office.NotificationMessages.deleteAsync(id);\n  }\n}\n\nfunction showNotification(id, options) {\n  if (\n    Office.NotificationMessages &&\n    typeof Office.NotificationMessages.addAsync === \"function\"\n  ) {\n    Office.NotificationMessages.addAsync(id, options);\n  }\n}\n\n// State for errors and control flow\nconst state = {\n  errors: [],\n  currentIndex: 0,\n  isChecking: false\n};\n\n// Highlight color for detected errors: light pink\nconst HIGHLIGHT_COLOR = \"#FFC0CB\";\nconst NOTIF_ID = \"noErrors\";\n\nOffice.onReady((info) => {\n  if (info.host === Office.HostType.Word) {\n    try {\n      Office.actions.associate(\"checkDocumentText\", checkDocumentText);\n      Office.actions.associate(\"acceptAllChanges\", acceptAllChanges);\n      Office.actions.associate(\"rejectAllChanges\", rejectAllChanges);\n      Office.actions.associate(\"acceptCurrentChange\", acceptCurrentChange);\n      Office.actions.associate(\"rejectCurrentChange\", rejectCurrentChange);\n    } catch (error) {\n      console.error(\"Function registration failed:\", error);\n      showNotification(\"regError\", {\n        type: \"errorMessage\",\n        message: \"Add-in initialization failed. Please reload.\",\n        persistent: false\n      });\n    }\n  }\n});\n\n// Map a raw word (letter or digit start) to the correct 's' or 'z'\nfunction determineCorrectPreposition(rawWord) {\n  if (!rawWord) return null;\n  // Normalize to NFC so É vs É are consistent\n  const word = rawWord.normalize(\"NFC\");\n  // Find first letter or digit via Unicode property escape\n  const match = word.match(/[\\p{L}0-9]/u);\n  if (!match) return null;\n  const firstChar = match[0].toLowerCase();\n\n  const unvoiced = new Set(['c','č','f','h','k','p','s','š','t']);\n  const numPron = {\n    '1':'e','2':'d','3':'t','4':'š','5':'p',\n    '6':'š','7':'s','8':'o','9':'d','0':'n'\n  };\n\n  if (/\\d/.test(firstChar)) {\n    const pron = numPron[firstChar];\n    return unvoiced.has(pron) ? \"s\" : \"z\";\n  }\n  return unvoiced.has(firstChar) ? \"s\" : \"z\";\n}\n\n// Main scan: highlight mismatches, or notify if none\nasync function checkDocumentText() {\n  if (state.isChecking) return;\n  state.isChecking = true;\n  clearNotification(NOTIF_ID);\n\n  try {\n    await Word.run(async (context) => {\n      // Clear previous highlights\n      state.errors.forEach(e => e.range.font.highlightColor = null);\n      state.errors = [];\n      state.currentIndex = 0;\n\n      const searchOptions = { matchCase: false, matchWholeWord: true };\n      let allRanges = [];\n\n      // helper: find standalone 's' or 'z'\n      async function addSearchResults(scope) {\n        const res = scope.search(\"\\\\b[sz]\\\\b\", searchOptions);\n        res.load(\"items\");\n        await context.sync();\n        allRanges.push(...res.items);\n      }\n\n      // Body, headers, footers, content controls, tables\n      await addSearchResults(context.document.body);\n\n      const secs = context.document.sections;\n      secs.load(\"items\"); await context.sync();\n      for (const s of secs.items) {\n        await addSearchResults(s.getHeader(\"Primary\"));\n        await addSearchResults(s.getFooter(\"Primary\"));\n      }\n\n      const ccs = context.document.contentControls;\n      ccs.load(\"items\"); await context.sync();\n      for (const cc of ccs.items) {\n        await addSearchResults(cc);\n      }\n\n      const tables = context.document.body.tables;\n      tables.load(\"items\"); await context.sync();\n      for (const t of tables.items) {\n        await addSearchResults(t.getRange());\n      }\n\n      // Filter exactly “s”/“z”\n      const candidates = allRanges.filter(r =>\n        [\"s\",\"z\"].includes(r.text.trim().toLowerCase())\n      );\n\n      const errors = [];\n      for (const prep of candidates) {\n        const after = prep.getRange(\"After\");\n        after.expandTo(Word.TextRangeUnit.word);\n        after.load(\"text\");\n        await context.sync();\n\n        const nextWord = after.text.trim();\n        if (!nextWord) continue;\n\n        const curr = prep.text.trim().toLowerCase();\n        const corr = determineCorrectPreposition(nextWord);\n        if (corr && curr !== corr) {\n          errors.push({ range: prep, suggestion: corr });\n        }\n      }\n\n      state.errors = errors;\n\n      if (errors.length === 0) {\n        showNotification(NOTIF_ID, {\n          type: \"informationalMessage\",\n          message: \"Ni najdenih napak.\",\n          icon: \"Icon.80x80\",\n          persistent: false\n        });\n        return;\n      }\n\n      // Highlight our errors and select the first\n      for (const e of errors) {\n        e.range.font.highlightColor = HIGHLIGHT_COLOR;\n      }\n      await context.sync();\n      errors[0].range.select();\n    });\n  } catch (e) {\n    console.error(\"checkDocumentText failed:\", e);\n    showNotification(\"checkError\", {\n      type: \"errorMessage\",\n      message: \"Preposition check failed. Please try again.\",\n      persistent: false\n    });\n  } finally {\n    state.isChecking = false;\n  }\n}\n\n// Accept/reject functions\nasync function acceptCurrentChange() {\n  if (state.currentIndex >= state.errors.length) return;\n  try {\n    await Word.run(async (context) => {\n      const err = state.errors[state.currentIndex];\n      try {\n        err.range.insertText(err.suggestion, Word.InsertLocation.replace);\n        err.range.font.highlightColor = null;\n      } catch {\n        await checkDocumentText(); // resync\n        return;\n      }\n      await context.sync();\n      state.currentIndex++;\n      if (state.currentIndex < state.errors.length) {\n        state.errors[state.currentIndex].range.select();\n      }\n    });\n  } catch (e) {\n    console.error(\"acceptCurrentChange failed:\", e);\n    showNotification(\"acceptError\", {\n      type: \"errorMessage\",\n      message: \"Failed to apply change. Please re-run the check.\",\n      persistent: false\n    });\n  }\n}\n\nasync function rejectCurrentChange() {\n  if (state.currentIndex >= state.errors.length) return;\n  try {\n    await Word.run(async (context) => {\n      const err = state.errors[state.currentIndex];\n      err.range.font.highlightColor = null;\n      await context.sync();\n      state.currentIndex++;\n      if (state.currentIndex < state.errors.length) {\n        state.errors[state.currentIndex].range.select();\n      }\n    });\n  } catch (e) {\n    console.error(\"rejectCurrentChange failed:\", e);\n    showNotification(\"rejectError\", {\n      type: \"errorMessage\",\n      message: \"Failed to reject change. Please re-run the check.\",\n      persistent: false\n    });\n  }\n}\n\nasync function acceptAllChanges() {\n  if (!state.errors.length) return;\n  try {\n    await Word.run(async (context) => {\n      for (const err of state.errors) {\n        err.range.insertText(err.suggestion, Word.InsertLocation.replace);\n        err.range.font.highlightColor = null;\n      }\n      await context.sync();\n      state.errors = [];\n    });\n  } catch (e) {\n    console.error(\"acceptAllChanges failed:\", e);\n    showNotification(\"acceptAllError\", {\n      type: \"errorMessage\",\n      message: \"Failed to apply all changes. Please try again.\",\n      persistent: false\n    });\n  }\n}\n\nasync function rejectAllChanges() {\n  if (!state.errors.length) return;\n  try {\n    await Word.run(async (context) => {\n      for (const err of state.errors) {\n        err.range.font.highlightColor = null;\n      }\n      await context.sync();\n      state.errors = [];\n    });\n  } catch (e) {\n    console.error(\"rejectAllChanges failed:\", e);\n    showNotification(\"rejectAllError\", {\n      type: \"errorMessage\",\n      message: \"Failed to clear changes. Please try again.\",\n      persistent: false\n    });\n  }\n}\n\n// Expose to ribbon/UI\nwindow.checkDocumentText   = checkDocumentText;\nwindow.acceptCurrentChange = acceptCurrentChange;\nwindow.rejectCurrentChange = rejectCurrentChange;\nwindow.acceptAllChanges    = acceptAllChanges;\nwindow.rejectAllChanges    = rejectAllChanges;\n"],"names":["showNotification","id","options","Office","NotificationMessages","addAsync","state","errors","currentIndex","isChecking","NOTIF_ID","determineCorrectPreposition","rawWord","match","normalize","firstChar","toLowerCase","unvoiced","Set","numPron","test","pron","has","async","checkDocumentText","deleteAsync","Word","run","forEach","e","range","font","highlightColor","searchOptions","matchCase","matchWholeWord","allRanges","addSearchResults","scope","res","search","load","context","sync","push","items","document","body","secs","sections","s","getHeader","getFooter","ccs","contentControls","cc","tables","t","getRange","candidates","filter","r","includes","text","trim","prep","after","expandTo","TextRangeUnit","word","nextWord","curr","corr","suggestion","length","select","type","message","icon","persistent","console","error","acceptCurrentChange","err","insertText","InsertLocation","replace","rejectCurrentChange","acceptAllChanges","rejectAllChanges","onReady","info","host","HostType","actions","associate","window"],"sourceRoot":""}